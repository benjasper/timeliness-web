<div class="w-full flex flex-col md:flex-row gap-16" *ngIf="user">
	<div *ngFor="let connection of user.googleCalendarConnections" class="flex flex-col">
		<div class="mb-8 text-left">
			<h4 class="text-lg text-primary">Connection {{ connection.email }}</h4>

			<ng-container *ngIf="connection.status === CONNECTION_STATUS.Active">
				<span *ngIf="calendars.get(connection.id)?.length ?? 0 > 0" class="label mt-4 text-grey-dark">
					Calendars indicating your availability
				</span>
				<ng-container *ngIf="!connectionLoading.get(connection.id)">
					<div *ngFor="let calendar of calendars.get(connection.id)" class="flex flex-row">
						<input
							[id]="calendar.calendarId"
							class="mr-4 my-auto"
							type="checkbox"
							[checked]="calendar.isActive"
							(change)="calendar.isActive = !calendar.isActive; saveChanges(connection.id, calendars.get(connection.id) ?? [])"
						/>
						<label [for]="calendar.calendarId" class="text-base text-black">{{ calendar.name }}</label>
					</div>
				</ng-container>
				<ng-container *ngIf="connectionLoading.get(connection.id)">
					<div *ngFor="let calendar of [1, 2, 3, 4, 5]" class="flex flex-row group hover:cursor-default">
						<div class="flex flex-row flex-wrap gap-4">
							<span class="sm-tag text-base grey-background px-8 py-1 border border-white rounded-full loading w-72">&nbsp;</span>
						</div>
					</div>
				</ng-container>
			</ng-container>
			<ng-container *ngIf="connection.status === CONNECTION_STATUS.Expired">
				<p class="text-red mt-4">
					It seems like your Google Calendar connection expired. <br>Please click the button below to reconnect.
				</p>
			</ng-container>
		</div>
		<div class="flex flex-row justify-between">
			<button class="mr-auto with-border" role="button" [ngSwitch]="connection.status" (click)="connect(connection.id)">
				<ng-container *ngSwitchCase="CONNECTION_STATUS.Inactive">
					Grant access
				</ng-container>
				<ng-container *ngSwitchCase="CONNECTION_STATUS.Active">Force reconnect</ng-container>
				<ng-container *ngSwitchCase="CONNECTION_STATUS.Expired">Reconnect</ng-container>
				<ng-container *ngSwitchDefault>Reconnect</ng-container>
			</button>
			<button role="button" class="danger" (click)="disconnect(connection.id)">
				Disconnect
			</button>
		</div>
	</div>
	<button *ngIf="user.googleCalendarConnections?.length === 0 || allowMoreThanOneConnection" class="!mr-auto !rounded-full flex-shrink-0 w-16 h-16 p-0" role="button" (click)="connect()">
		<svg-icon class="img !m-auto" src="/assets/icons/icon-plus.svg"></svg-icon>
	</button>
</div>
