<div class="dashboard-container">
	<div class="dashboard-container main">
		<section class="next-up-section wrapper">
			<div class="dashboard-header">
				<h2 class="next-up-title">{{ getNextUpMessage() }}</h2>
				<a class="btn large" [routerLink]="[{ outlets: { modal: ['task', 'new'] } }]">
					<svg-icon class="img" src="/assets/icons/icon-plus.svg"></svg-icon>
					<span>New task</span>
				</a>
			</div>
			<img
				*ngIf="nextUp.length === 0 && !loadingWorkUnits"
				class="next-up-finished"
				src="/assets/icons/icon-done.svg"
				alt="All done"
			/>
			<app-slider *ngIf="nextUp.length > 0 && !loadingWorkUnits" class="next-up-slider" [listArray]="nextUp" [showButtons]="nextUp.length > 1" [startsAtIndex]="getStartsAtWorkUnit()">
				<ul class="next-up scroller">
					<ng-container *ngIf="loadingWorkUnits">
						<li *ngFor="let index of [1, 2]">
							<app-work-unit-card [loading]="true"></app-work-unit-card>
						</li>
					</ng-container>
					<ng-container *ngIf="nextUp.length > 0 && !loadingWorkUnits">
						<li *ngFor="let task of nextUp">
							<app-work-unit-card
								[task]="task"
								[workUnitIndex]="task.workUnitsIndex"
							></app-work-unit-card>
						</li>
					</ng-container>
				</ul>
			</app-slider>
		</section>
		<section class="lower-dashboard">
			<div class="upcoming-workunits">
				<div class="upcoming-work-units-header padding-wrapper">
					<h2 class="upcoming-work-units-title">Upcoming work units</h2>
					<!--
					// TODO: Not working yet
					<div class="filters">
						<button class="btn filter active">
							<svg-icon class="img" src="/assets/icons/icon-arrow.svg"></svg-icon>
							Upcoming
						</button>
						<button class="btn filter">
							<svg-icon class="img" src="/assets/icons/icon-check.svg"></svg-icon>
							Done
						</button>
					</div>
					-->
				</div>
				<img
					*ngIf="groupedUpcoming.length === 0 && !loadingWorkUnits"
					class="next-up-finished"
					src="/assets/images/no-workunits.svg"
					alt="No upcoming"
				/>
				<ul class="upcoming-work-units-list scroller padding-wrapper">
					<ng-container *ngIf="loadingWorkUnits">
						<li *ngFor="let index of [1, 2, 3]">
							<app-work-unit-upcoming [loading]="true"></app-work-unit-upcoming>
						</li>
					</ng-container>
					<ng-container *ngIf="!loadingWorkUnits">
						<li *ngFor="let upcomingGroup of groupedUpcoming" class="date-group">
							<span
								*ngIf="
									today.getWeekNumber(true) !== upcomingGroup.date.getWeekNumber(true) &&
									today.addDays(7).getWeekNumber(true) !== upcomingGroup.date.getWeekNumber(true)
								"
								class="date-spacer"
							>
								{{
									upcomingGroup.date.toLocaleDateString('default', { year: 'numeric', month: 'long' })
								}}
							</span>
							<span
								*ngIf="today.getWeekNumber(true) === upcomingGroup.date.getWeekNumber(true)"
								class="date-spacer"
							>
								This week
							</span>
							<span
								*ngIf="today.addDays(7).getWeekNumber(true) === upcomingGroup.date.getWeekNumber(true)"
								class="date-spacer"
							>
								Next week
							</span>
							<ul>
								<li *ngFor="let task of upcomingGroup.tasks">
									<app-work-unit-upcoming [task]="task"></app-work-unit-upcoming>
								</li>
							</ul>
						</li>
					</ng-container>
				</ul>
			</div>

			<div class="section-stats">
				<h2 class="stats-title">Stats</h2>
				<div class="grid widgets-large">
					<app-stats class="large-widget">
						<div class="left">
							<span class="info">Your plan today</span>
							<span class="title">1 of 3 work units completed</span>
						</div>
						<div class="progress">
							<app-circular-progress [progress]="33"></app-circular-progress>
						</div>
					</app-stats>
				</div>
				<div class="grid widgets-small">
					<app-stats class="simple-widget">
						<span class="info">7</span>
						<span class="title">
							<svg-icon class="img" src="/assets/icons/icon-clipboard-check.svg"></svg-icon>
							Tasks completed this week
						</span>
					</app-stats>
					<app-stats class="simple-widget">
						<span class="info">12</span>
						<span class="title">
							<svg-icon class="img" src="/assets/icons/icon-check-multiple.svg"></svg-icon>
							Work units completed this week
						</span>
					</app-stats>
				</div>
			</div>
		</section>
	</div>
	<div class="dashboard-container deadlines">
		<h2>Upcoming deadlines</h2>
		<ul class="deadline-list scroller">
			<li *ngIf="groupedDeadlines.length === 0 && !loadingTasks" class="list-message">
				<span class="big">No tasks right now?</span>
				<span>That's awesome! But in case you have something to do tap "New task" to create a task.</span>
			</li>
			<ng-container *ngIf="loadingTasks">
				<li *ngFor="let index of [1, 2, 3]">
					<app-deadline [loading]="true"></app-deadline>
				</li>
			</ng-container>
			<ng-container *ngIf="!loadingTasks">
				<li *ngFor="let deadlineGroup of groupedDeadlines" class="date-group">
					<span class="date-spacer">
						{{
							deadlineGroup.date.toLocaleDateString('default', {
								weekday: 'long'
							})
						}},
						{{
							deadlineGroup.date.toLocaleDateString('default', {
								year: 'numeric',
								month: 'long',
								day: 'numeric'
							})
						}}
					</span>
					<ul class="dategroup-list">
						<li *ngFor="let deadline of deadlineGroup.tasks">
							<app-deadline [task]="deadline"></app-deadline>
						</li>
					</ul>
				</li>
			</ng-container>
		</ul>
	</div>
	<router-outlet name="modal"></router-outlet>
</div>
