<div class="dashboard-container">
	<div class="dashboard-container main">
		<section class="next-up-section wrapper">
			<div class="dashboard-header">
				<h2 class="next-up-title"
					[ngSwitch]="nextUpState">
					<ng-container *ngSwitchCase="eNextUpState.Done">All done for today!</ng-container>
					<ng-container *ngSwitchCase="eNextUpState.WorkingOn">Currently working on&nbsp;
						<span class="text-purple">{{ nextUpTaskFocus?.name }}</span>
					</ng-container>
					<ng-container *ngSwitchCase="eNextUpState.TaskFinish">Did you finish&nbsp;
						<span class="text-purple">{{ nextUpTaskFocus?.name }}</span>?
					</ng-container>
					<ng-container *ngSwitchCase="eNextUpState.WorkUnitFinish">Did you successfully work on&nbsp;
						<span class="text-purple">{{ nextUpTaskFocus?.name }}</span>?
					</ng-container>
					<ng-container *ngSwitchCase="eNextUpState.NoTasks">No tasks for today!</ng-container>
					<ng-container *ngSwitchCase="eNextUpState.NextTask">Next up:&nbsp;<span class="text-purple">
							{{ nextUpTaskFocus?.name }}</span>&nbsp;at
						<span class="text-purple">&nbsp;{{
							nextUpTaskFocus?.workUnit?.scheduledAt?.date?.start?.toDate()?.toLocaleTimeString([], {hour:
							'2-digit',minute: '2-digit'}) }}</span>
					</ng-container>
					<ng-container *ngSwitchDefault>Next up</ng-container>
				</h2>
				<a class="btn large"
				   [routerLink]="[{ outlets: { modal: ['task', 'new'] } }]">
					<svg-icon class="img"
							  src="/assets/icons/icon-plus.svg"></svg-icon>
					<span>New task</span>
				</a>
			</div>
			<div class="flex flex-row">
				<img *ngIf="nextUp.length === 0 && !loadingWorkUnits"
					 class="next-up-finished"
					 src="/assets/icons/icon-done.svg"
					 alt="All done" />
				<app-slider class="next-up-slider w-full"
							[listArray]="nextUp"
							[showButtons]="nextUp.length > 1"
							[startsAtIndex]="getStartsAtWorkUnit()">
					<ul class="next-up scroller w-full overflow-hidden">
						<ng-container *ngIf="loadingWorkUnits">
							<li *ngFor="let index of [1, 2]">
								<app-work-unit-card [loading]="true"></app-work-unit-card>
							</li>
						</ng-container>
						<ng-container *ngIf="nextUp.length > 0 && !loadingWorkUnits">
							<li *ngFor="let task of nextUp">
								<app-work-unit-card [task]="task"
													[workUnitIndex]="task.workUnitsIndex"></app-work-unit-card>
							</li>
						</ng-container>
					</ul>
				</app-slider>
			</div>
		</section>
		<section class="lower-dashboard wrapper !pr-12">
			<div class="upcoming-workunits">
				<div class="upcoming-work-units-header">
					<h2 class="upcoming-work-units-title">
						<svg-icon class="img my-auto pr-4 w-16"
								  src="/assets/icons/icon-work-unit.svg"></svg-icon>
						Upcoming work units
					</h2>
				</div>
				<img *ngIf="groupedUpcoming.length === 0 && !loadingWorkUnits"
					 class="next-up-finished"
					 src="/assets/images/no-workunits.svg"
					 alt="No upcoming" />
				<ul class="upcoming-work-units-list scroller">
					<ng-container *ngIf="loadingWorkUnits">
						<li *ngFor="let index of [1, 2, 3]">
							<app-work-unit-upcoming [loading]="true"></app-work-unit-upcoming>
						</li>
					</ng-container>
					<ng-container *ngIf="!loadingWorkUnits">
						<li *ngFor="let upcomingGroup of groupedUpcoming"
							class="date-group">
							<span *ngIf="
									today.getWeekNumber(true) !== upcomingGroup.date.getWeekNumber(true) &&
									today.addDays(7).getWeekNumber(true) !== upcomingGroup.date.getWeekNumber(true)
								"
								  class="date-spacer">
								{{
								upcomingGroup.date.toLocaleDateString('default', { month: 'long', year:
								(workUnitYears.get(upcomingGroup.date.getMonth())?.length ?? 1) > 1 ? 'numeric' :
								undefined })
								}}
							</span>
							<span *ngIf="today.getWeekNumber(true) === upcomingGroup.date.getWeekNumber(true)"
								  class="date-spacer">
								This week
							</span>
							<span *ngIf="today.addDays(7).getWeekNumber(true) === upcomingGroup.date.getWeekNumber(true)"
								  class="date-spacer">
								Next week
							</span>
							<ul>
								<li *ngFor="let task of upcomingGroup.tasks">
									<app-work-unit-upcoming [task]="task"></app-work-unit-upcoming>
								</li>
							</ul>
						</li>
					</ng-container>
				</ul>
			</div>

			<div class="section-stats flex flex-col pb-8">
				<h2 class="stats-title">
					<svg-icon class="img my-auto pr-4 w-16"
							  src="/assets/icons/icon-statistics.svg"></svg-icon>
					Stats
				</h2>
				<app-stats-section class="scroller w-full h-auto"></app-stats-section>
			</div>
		</section>
	</div>
	<div class="dashboard-container deadlines"
		 [class.extended]="deadlinesCollapsed">
		<div class="deadlines-header">
			<div class="toggle"
				 (click)="toggleDeadlines()">
				<svg-icon class="img"
						  src="/assets/icons/icon-arrow-down.svg"></svg-icon>
			</div>
			<h2 class="hide-collapsed wrapper">
				<svg-icon class="img my-auto pr-4 w-16"
						  src="/assets/icons/icon-deadline.svg"></svg-icon>
				Upcoming deadlines
			</h2>
		</div>
		<ul class="deadline-list scroller">
			<li *ngIf="groupedDeadlines.length === 0 && !loadingTasks"
				class="list-message">
				<span class="big">No tasks right now?</span>
				<span>That's awesome! But in case you have something to do tap "New task" to create a task.</span>
			</li>
			<ng-container *ngIf="loadingTasks">
				<li *ngFor="let index of [1, 2, 3]">
					<app-deadline [loading]="true"></app-deadline>
				</li>
			</ng-container>
			<ng-container *ngIf="!loadingTasks">
				<li *ngFor="let deadlineGroup of groupedDeadlines"
					class="date-group">
					<span class="date-spacer">
						{{
						deadlineGroup.date.toLocaleDateString('default', {
						year: (deadlineYears.get(deadlineGroup.date.getMonth())?.length ?? 1) > 1 ? 'numeric' :
						undefined,
						month: 'long',
						day: 'numeric',
						weekday: 'long'
						})
						}}
					</span>
					<ul class="dategroup-list">
						<li *ngFor="let deadline of deadlineGroup.tasks">
							<app-deadline [task]="deadline"></app-deadline>
						</li>
					</ul>
				</li>
			</ng-container>
		</ul>
	</div>
	<router-outlet name="modal"></router-outlet>
</div>